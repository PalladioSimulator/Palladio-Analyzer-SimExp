package org.palladiosimulator.simexp.markovian.exploitation;

import static org.palladiosimulator.simexp.markovian.util.MarkovianUtil.toSamples;

import java.util.Set;

import org.palladiosimulator.simexp.distribution.factory.ProbabilityDistributionFactory;
import org.palladiosimulator.simexp.distribution.function.ProbabilityMassFunction;
import org.palladiosimulator.simexp.distribution.function.ProbabilityMassFunction.Sample;
import org.palladiosimulator.simexp.markovian.activity.Policy;
import org.palladiosimulator.simexp.markovian.model.markovmodel.markoventity.Action;
import org.palladiosimulator.simexp.markovian.model.markovmodel.markoventity.State;
import org.palladiosimulator.simexp.markovian.model.markovmodel.markoventity.Transition;

public class ProbabilityBasedTransitionPolicy<T>
        implements Policy<T, Transition<T, Double>, Action<Transition<T, Double>>> {

    private final static String POLICY_NAME = "ProbabilityBasedTransitionSelection";

    @Override
    public Action<Transition<T, Double>> select(State<T> source, Set<Action<Transition<T, Double>>> options) {
        Set<Sample<Transition<T, Double>>> samples = toSamples(options);
        ProbabilityMassFunction<Transition<Double>> pmf = ProbabilityDistributionFactory.INSTANCE.pmfOver(samples);
        Sample<Transition<T, Double>> drawSample = pmf.drawSample();
        return drawSample.getValue();
    }

    @Override
    public String getId() {
        return POLICY_NAME;
    }

}
